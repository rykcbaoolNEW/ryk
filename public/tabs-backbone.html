<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
	/>
	<title>Scramjet</title>

	<link rel="shortcut icon" content="favicon.webp" />

	<script src="/scram/scramjet.all.js"></script>
	<script src="/baremux/index.js"></script>
	<script src="fixing.js"></script>

	<link rel="stylesheet" href="index.css" />
	<script src="register-sw.js" defer></script>
	<script src="search.js" defer></script>
	<script src="index.js" defer></script>
</head>


<body>



<div class="settings-dropdown" id="settings">
	<label>Search Engine</label>
	<select id="engine-select">
		<option value="https://www.duckduckgo.com/?q=%s">DuckDuckGo</option>
		<option value="https://www.google.com/search?q=%s">Google</option>
		<option value="https://www.bing.com/search?q=%s">Bing</option>
	</select>

	<label>Theme</label>
	<select id="theme-select">
		<option value="">Dark</option>
		<option value="light">Light</option>
		<option value="neon">Neon</option>
	</select>
</div>

<main class="content">

	<!-- Logo -->
	<div class="home-logo">
		<img class="main-logo" src="img.png" alt="Scramjet" />
	</div>

	<!-- Search -->
	<form id="sj-form" class="search-wrapper">
		<input
				id="sj-search-engine"
				value="https://www.duckduckgo.com/?q=%s"
				type="hidden"
		/>
		<input id="sj-address" type="text" placeholder="Search the web" />
	</form>
	<script>
		async function waitForScramjet(timeout = 5000) {
			const interval = 50; // ms
			let waited = 0;

			return new Promise((resolve, reject) => {
				const check = () => {
					if (window.$scramjet && typeof $scramjet.navigate === "function") {
						resolve($scramjet);
					} else {
						waited += interval;
						if (waited >= timeout) {
							reject(new Error("Scramjet did not initialize in time"));
						} else {
							setTimeout(check, interval);
						}
					}
				};
				check();
			});
		}

		async function navigateSafely(url) {
			try {
				const scramjet = await waitForScramjet();
				await scramjet.navigate(url); // always proxied
			} catch (err) {
				console.error("Failed to proxy through Scramjet:", err);
			}
		}

		// Form listener
		document.addEventListener("DOMContentLoaded", () => {
			document.getElementById("sj-form").addEventListener("submit", (e) => {
				e.preventDefault();
				const query = document.getElementById("sj-address").value.trim();
				const searchEngine = document.getElementById("sj-search-engine").value;
				const url = searchEngine.replace("%s", encodeURIComponent(query));

				navigateSafely(url); // will wait for Scramjet
			});
		});
	</script>

	<div class="desc">
		<p id="sj-error"></p>
		<pre id="sj-error-code"></pre>
	</div>

</main>

</body>
</html>